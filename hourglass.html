<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        p {
            font-family: "Courier New", Courier, monospace;
            font-size: 2em;	
        }
    </style>
</head>
<body>
    <h1>Hourglass Demo</h1>
    <p id="clock"> </p>
</body>
    <script>        
        var screen = document.getElementById('clock');

        var hourglass = {time: 0};
        hourglass.init = function(size) {
            this.size = size * 2 + 1;
            this.arr = [];
            var n = this.size;

            //init array
            for (var i = 0; i < n; i++) {
                this.arr.push([]);
                for (var j = 0; j < n; j++) {
                    this.arr[i][j] = "&nbsp;";
                }
            }

            //init start point
            this.i = 0;
            this.j = size;
            this.stage = "start";
            this.step = 0;
        };

        //draw first line
        hourglass.start = function() {
            this.i = this.step;
            this.arr[this.i][this.j] = "+";
            
            this.step++;
            if (this.step == this.size) {
                this.stage = "middle";
                this.step = 0;
                this.width = Math.floor(this.size/2);
            }
        }

        //draw triangle
        hourglass.middle = function() {  
            if (this.width === 0) {
                this.stage = "last";
                this.step = 0;
                this.height = Math.floor(this.size / 2);
                return;
            }         
            this.step++;            
            this.arr[this.i][this.j - this.step] = "+";  
            this.arr[this.i][this.j + this.step] = "+";

            if (this.step  === this.width) {
                this.i--;
                this.width--;
                this.step = 0;
            }
        }

        hourglass.last = function() {
            this.i = this.step;
            this.arr[this.i][this.j] = " ";
            this.step++;
            if(this.step == this.height) {
                this.stage = "end";
            }
        }

        hourglass.draw = function() {
            var ret = "";
            for (var i = 0; i < this.size; i++) {
                ret += this.arr[i].join("") + "<br>\n";
            }
            screen.innerHTML = ret;
        };      
        
        hourglass.next = function() {            
            switch(this.stage) {
                case "start":
                    hourglass.start();
                break;

                case "middle":
                    hourglass.middle();
                break;
                case "last":
                    hourglass.last();
                break;
                default:
                    console.log("The end");
                    clearInterval(this.tid)
            }
        };
        
        var go = function() {
            hourglass.next();
            hourglass.draw();
        }

        hourglass.init(10);
        hourglass.tid = setInterval(go, 120);

    </script>
</html>
